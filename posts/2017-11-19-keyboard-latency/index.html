<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Keyboard input latency</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="description" content="Michael Stapelberg’s private website, containing articles about computers and programming, mostly focused on Linux.">
    <link rel="canonical" href="https://michael.stapelberg.de/posts/2017-11-19-keyboard-latency/">
    <meta name="author" content="Michael Stapelberg">
    <meta name="keywords" content="Michael, Stapelberg, Linux, Debian">
    <style type="text/css">
@font-face {
  font-family: 'Yanone Kaffeesatz Regular';
  font-style: normal;
  font-weight: 400;
  src: local('Yanone Kaffeesatz Regular'), url('/YanoneKaffeesatz-Regular.ttf') format('truetype');
}

@font-face {
  font-family: 'Droid Sans';
  font-style: normal;
  font-weight: normal;
  src: local('Droid Sans'), local('DroidSans'), url('/droid_sans.ttf') format('truetype');
}

@font-face {
  font-family: 'Droid Sans';
  font-style: normal;
  font-weight: bold;
  src: local('Droid Sans Bold'), local('DroidSans-Bold'), url('/droid_sans_bold.ttf') format('truetype');
}

body, td, th {
  font-family: 'Droid Sans', Verdana, Arial, Helvetica, sans-serif;
  font-size: 16px;
  color: #000;
} 
    </style>
    <link rel="stylesheet" href="/2.css" type="text/css">
    <link rel="stylesheet" href="/1.css" type="text/css">
    <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="ATOM Feed">
</head>


<body><div class="container-fluid"><div class="row"><div id="menu" class="col-md-2"><h1>Michael Stapelberg</h1><ul class="menu_open">
<li><a class="menu_item" href="/"><span class="menu_title">Startseite</span></a></li>
<li><a class="menu_item" href="/posts/"><span class="menu_title">Artikel</span></a></li>
<li><a class="menu_item" href="/dokumente/"><span class="menu_title">Dokumente</span></a></li>
<li><a class="menu_item" href="/programme/"><span class="menu_title">Programme</span></a>
<div class="subitem">
<ul class="menu_open">
  <li><a class="menu_item" href="https://gokrazy.github.io/"><span class="menu_title">gokrazy</span></a></li>
  <li><a class="menu_item" href="https://i3wm.org/"><span class="menu_title">i3</span></a></li>
<li><a class="menu_item" href="https://robustirc.net/"><span class="menu_title">RobustIRC</span></a></li>
<li><a class="menu_item" href="https://www.x11vis.org/"><span class="menu_title">x11vis</span></a></li>
<li><a class="menu_item" href="/c128_kasse"><span class="menu_title">c128_kasse</span></a></li>
</ul>
</div>
</li>

<li><a class="menu_item" href="https://www.debian.org/"><span class="menu_title">Debian</span></a>
<div class="subitem">
<ul class="menu_open">
  <li><a class="menu_item" href="https://codesearch.debian.net/"><span class="menu_title">Debian Code Search</span></a></li>
  <li><a class="menu_item" href="https://manpages.debian.org/"><span class="menu_title">manpages.debian.org</span></a></li>
</ul>
</div>
</li>

<li><a class="menu_item" href="/talks"><span class="menu_title">Talks</span></a></li>

<li><a class="menu_item" href="/tipps"><span class="menu_title">Tipps</span></a></li>

<li><a class="menu_item" href="/meinepcs"><span class="menu_title">Hardware</span></a></li>
<li><a class="menu_item" href="/impressum"><span class="menu_title">Impressum</span></a></li></ul>

</div><div id="contentBox" class="col-md-10"><h2 class="title">Keyboard input latency</h2> (<span id="date">2017-11-19</span>) <div class="Artikel" id="content">


<p>I positioned my keyboard as close as possible to the monitor, then used my
iPhone to shoot a slo-mo video of me pressing keys while running <code>sm(1)</code>.</p>

<p>To quickly get an unmodified copy, I opened Apple Photos (TODO) and shared the
file with Google Drive and downloaded it from there. Side note: an upspin
dirserver+fileserver iOS app would be amazing. TODO</p>

<p>Converted the video from Apple’s H264 into individual JPG frames:</p>

<pre><code>ffmpeg -i IMG_1748.MOV frame%05d.png
</code></pre>

<p>For conveniently moving through the recording frame-by-frame, I opened the file
in <code>avidemux3_qt5</code>. Here is a timeline of frames:</p>

<ol>
<li>frame 1595 LED off, no characters</li>
<li>frame 1596 LED on, no characters</li>
<li>frame 1600 LED on, screen starts updating</li>
<li>frame 1609 LED on, character appears (after animation)
1610
1611
1612
1613
1614
frame 1615 LED off</li>
</ol>

<p>Each frame is 4.16ms long, so a latency of 4 frames is equivalent to 16.6ms.</p>

<p>frame 2796 led off
frame 2797 led on
frame 2798 led on, screen update
2799
2800
frame 2801 led off (10ms after led on)
latency of one is equivalent to 4.16ms</p>

<h3 id="connectivity">Connectivity</h3>

<p>TODO: measure whether the teensy code runs in &lt;1ms, otherwise we delay the poll rate
TODO: change code to permanently scan, so that buffer is already full at poll time, and polls are shorter</p>

<p>TODO: teensy++ 2.0 (which i’m using currently) has no DMA.</p>

<p>Currently used pins: D0-D7, B0-B6, F0-F3 (leds), C0-C6
8+7+7(+4) = 26</p>

<p>Teensy 3.6 has: A9-A10 (10) + A22-A14 (8)</p>

</div></div></div></div></div></div></body>
</html>
